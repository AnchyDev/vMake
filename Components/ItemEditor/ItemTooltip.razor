@using vMake.Database.Types
@using vMake.Extensions

@if(this.Template is not null)
{
    <div class="vmake-item-tooltip">
        <span style="color: #@(this.Template.ItemTemplate.Quality.GetHexColor())">
            @this.Template.ItemTemplate.Name
        </span>

        <span style="color: #E3BF00">
            Item Level @this.Template.ItemTemplate.ItemLevel
        </span>

        @if(this.Template.ItemTemplate.Flags.HasFlag(MangosItemFlags.ITEM_FLAG_CONJURED))
        {
            <span>Conjured Item</span>
        }

        <span class="@(this.Template.ItemTemplate.Bonding == MangosItemBonding.None ? "hide" : "")">
            @this.Template.ItemTemplate.Bonding.GetBondingText()
        </span>

        @if(this.Template.ItemTemplate.MaxCount > 0)
        {
            <span>
                Unique @(this.Template.ItemTemplate.MaxCount > 1 ? $"({this.Template.ItemTemplate.MaxCount})" : "")
            </span>
        }

        @if(this.Template.ItemTemplate.InventoryType != MangosInventoryType.NotEquipable)
        {
            <div style="display: flex; flex-direction: row">
                <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                    @this.Template.ItemTemplate.InventoryType.GetInventoryTypeText()
                </span>
                <span style="flex: 1;text-align: end;">
                    @this.Template.ItemTemplate.ItemClass.GetSubClassText(this.Template.ItemTemplate.ItemSubClass)
                </span>
            </div>
        }

        @if(this.Template.ItemTemplate.ItemClass == MangosItemClass.Weapon &&
            this.Template.ItemTemplate.DmgMax1 > 0)
        {
            <div style="display: flex; flex-direction: row">
                <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                    @this.Template.ItemTemplate.DmgMin1 - @this.Template.ItemTemplate.DmgMax1 @(this.Template.ItemTemplate.DmgType1 != MangosItemDamageType.Physical ? this.Template.ItemTemplate.DmgType1 : "") Damage
                </span>
                <span>
                    Speed @(((decimal)this.Template.ItemTemplate.Delay / 1000).ToString("0.00"))
                </span>
            </div>
        }

        @if (this.Template.ItemTemplate.ItemClass == MangosItemClass.Weapon &&
            this.Template.ItemTemplate.DmgMax2 > 0)
        {
            <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                +@this.Template.ItemTemplate.DmgMin2 - @this.Template.ItemTemplate.DmgMax2 @(this.Template.ItemTemplate.DmgType2 != MangosItemDamageType.Physical ? this.Template.ItemTemplate.DmgType2 : "") Damage
            </span>
        }

        @if (this.Template.ItemTemplate.ItemClass == MangosItemClass.Weapon &&
       this.Template.ItemTemplate.DmgMax3 > 0)
        {
            <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                +@this.Template.ItemTemplate.DmgMin3 - @this.Template.ItemTemplate.DmgMax3 @(this.Template.ItemTemplate.DmgType3 != MangosItemDamageType.Physical ? this.Template.ItemTemplate.DmgType3 : "") Damage
            </span>
        }

        @if (this.Template.ItemTemplate.ItemClass == MangosItemClass.Weapon &&
            this.Template.ItemTemplate.DmgMax4 > 0)
        {
            <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                +@this.Template.ItemTemplate.DmgMin4 - @this.Template.ItemTemplate.DmgMax4 @(this.Template.ItemTemplate.DmgType4 != MangosItemDamageType.Physical ? this.Template.ItemTemplate.DmgType4 : "") Damage
            </span>
        }

        @if (this.Template.ItemTemplate.ItemClass == MangosItemClass.Weapon &&
            this.Template.ItemTemplate.DmgMax5 > 0)
        {
            <span style="flex: 1;" class="@(this.Template.ItemTemplate.InventoryType == MangosInventoryType.NotEquipable ? "hide" : "")">
                +@this.Template.ItemTemplate.DmgMin5 - @this.Template.ItemTemplate.DmgMax5 @(this.Template.ItemTemplate.DmgType5 != MangosItemDamageType.Physical ? this.Template.ItemTemplate.DmgType5 : "") Damage
            </span>
        }

        @{
            if(this.Template.ItemTemplate.InventoryType == MangosInventoryType.Ammo)
            {
                var dps = (this.Template.ItemTemplate.DmgMin1 + this.Template.ItemTemplate.DmgMax1) / 2f;
                if (dps > 0)
                {
                    <span>Adds @dps.ToString("##.#") damage per second</span>
                }
            }
            else
            {
                var dps = this.Template.ItemTemplate.GetDps();
                if (dps > 0)
                {
                    <span>(@dps.ToString("##.0") damage per second)</span>
                }
            }
        }

        <span class="@(this.Template.ItemTemplate.Armor < 1 ? "hide" : "")">
            @this.Template.ItemTemplate.Armor Armor
        </span>

        @{
            var stats = this.Template.ItemTemplate.GetStats();

            foreach (var stat in stats)
            {
                <div class="@(stat.Type == MangosItemStatType.None ? "hide" : "")">
                    <span>@(stat.Value > 0 ? "+" : "-")@(Math.Abs(stat.Value))</span>
                    <span>@stat.Type</span>
                </div>
            }
        }

        @{
            var resistances = this.Template.ItemTemplate.GetResists();

            foreach (var resist in resistances)
            {
                if(resist.Value == 0)
                {
                    continue;
                }

                <div>
                    <span>@(resist.Value > 0 ? "+" : "-")@Math.Abs(resist.Value) @resist.Key.ToString() Resistance</span>
                </div>
            }
        }

        @if (Template.ItemTemplate.DurabilityMax > 0)
        {
            <span>
                Durability @Template.ItemTemplate.DurabilityMax / @Template.ItemTemplate.DurabilityMax
            </span>
        }

        <span class="@(this.Template.ItemTemplate.RequiredLevel < 1 ? "hide" : "")">
            Requires Level @this.Template.ItemTemplate.RequiredLevel
        </span>

        @{
            var spells = this.Template.ItemTemplate.GetSpells(DbContext);

            foreach (var spell in spells)
            {
                if(spell.Entry == 0)
                {
                    continue;
                }

                if(string.IsNullOrWhiteSpace(spell.Description))
                {
                    <div style="color: #FF0000">
                        <span>@spell.Trigger.GetTriggerText(): </span>
                        <span>This spell has no description.</span>
                    </div>
                }
                else
                {
                    <div style="color: #00FF00">
                        <span>@spell.Trigger.GetTriggerText(): </span>
                        <span>@spell.Description</span>
                    </div>
                }
            }
        }

        <span style="color: #E1D474" class="@(string.IsNullOrWhiteSpace(this.Template.ItemTemplate.Description) ? "hide" : "")">
            "@this.Template.ItemTemplate.Description"
        </span>

        @if(this.Template.ItemTemplate.SellPrice > 0)
        {
            var currency = MangosCurrency.ToCurrency(this.Template.ItemTemplate.SellPrice);

            <div style="display: flex; flex-direction: row; gap: 0.25rem; align-items: center">
                <span>Sell Price:</span>
                @if(currency.Gold > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Gold</span>
                        <img src="assets/images/currency/gold.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
                @if (currency.Silver > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Silver</span>
                        <img src="assets/images/currency/silver.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
                @if (currency.Copper > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Copper</span>
                        <img src="assets/images/currency/copper.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
            </div>
        }

        @if (this.Template.ItemTemplate.BuyPrice > 0)
        {
            var currency = MangosCurrency.ToCurrency(this.Template.ItemTemplate.BuyPrice);

            <div style="display: flex; flex-direction: row; gap: 0.25rem; align-items: center">
                <span>Buy Price:</span>
                @if (currency.Gold > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Gold</span>
                        <img src="assets/images/currency/gold.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
                @if (currency.Silver > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Silver</span>
                        <img src="assets/images/currency/silver.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
                @if (currency.Copper > 0)
                {
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 0.1rem">
                        <span>@currency.Copper</span>
                        <img src="assets/images/currency/copper.png" style="width: 1rem; height: 1rem" />
                    </div>
                }
            </div>
        }
    </div>
}
else
{
    <span class="alert-danger">Tooltip Template is null.</span>
}