@page
@model vMake.Pages.Edit.Item.IndexModel
@using vMake.Extensions
@using vMake.Database.Types;
@{
    ViewData["Title"] = "Edit Item";

    var itemTemplate = this.Model.ItemTemplate;
}

@section Scripts {
    <script type="text/javascript">
        // Update the tooltip when the form changes.

        $(document).ready(function () {
            $('#form-name').on('input', function () {
                $('#tooltip-name').text(`${$(this).val()}`);
            });

            $('#form-description').on('input', function () {
                $('#tooltip-description').text(`"${$(this).val()}"`);
            });

            $('#form-bonding').on('input', function () {
                $('#tooltip-bonding').text(`${$(this).find('option:selected').text()}`);
            });

            $('#form-itemlevel').on('input', function () {
                $('#tooltip-itemlevel').text(`Item Level ${$(this).val()}`);
            });

            $('#form-reqlevel').on('input', function () {
                $('#tooltip-reqlevel').text(`Requires Level ${$(this).val()}`);
            });

            $('#form-armor').on('input', function () {
                $('#tooltip-armor').text(`Requires Level ${$(this).val()}`);
            });

            for (let i = 1; i < 11; i++) {
                $(`#form-stat-type-${i}`).on('input', function () {
                    let type = parseInt($(this).val());
                    console.log(type);
                    console.log(`#tooltip-stat-${i}`);
                    if (type == 0) {
                        $(`#tooltip-stat-${i}`).hide();
                    }
                    else {
                        $(`#tooltip-stat-${i}`).show();
                    }

                    $(`#tooltip-stat-type-${i}`).text(`${$(this).find('option:selected').text()}`);
                });
            }

            for (let i = 1; i < 11; i++) {
                $(`#form-stat-value-${i}`).on('input', function () {
                    let value = parseInt($(this).val());
                    let sign = value > 0 ? '+' : '';

                    console.log(value);
                    console.log(sign);

                    $(`#tooltip-stat-value-${i}`).text(`${sign}${value}`);
                });
            }
        });
    </script>
}

@if (itemTemplate is null)
{
    <form method="post" class="vmake-form">
        <input type="hidden" name="type" value="edit" />

        <div class="vmake-form-item">
            <label for="Entry">Entry Id</label>
            <input type="text" name="Entry" />
        </div>

        <div class="vmake-form-item">
            <button type="submit">Edit</button>
        </div>
    </form>
}
else
{
    <div class="vmake-panel-h">
        <form method="post" class="vmake-form" style="flex: 8">
            <div class="vmake-form-item">
                <h2>Editing Item Entry @itemTemplate.Entry</h2>
            </div>

            <input type="hidden" name="type" value="update"/>
            
            <input type="hidden" asp-for="ItemTemplate!.Entry" value="@itemTemplate.Entry" />

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.Name">Name (Max 255 chars)</label>
                <input id="form-name" asp-for="ItemTemplate!.Name" type="text" value="@itemTemplate.Name" maxlength="255" />
            </div>

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.Description">Description (Max 255 chars)</label>
                <input id="form-description" asp-for="ItemTemplate!.Description" type="text" value="@itemTemplate.Description" maxlength="255" />
            </div>

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.Bonding">Bonding</label>
                <select id="form-bonding" asp-for="ItemTemplate!.Bonding" >
                    @foreach(MangosItemBonding bonding in Enum.GetValues(typeof(MangosItemBonding)))
                    {
                        if(itemTemplate.Bonding == bonding)
                        {
                            <option value="@bonding" selected>@bonding.GetBondingText()</option>
                        }
                        else
                        {
                            <option value="@bonding">@bonding.GetBondingText()</option>
                        }
                    }
                </select>
            </div>

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.ItemLevel">Item Level (0-255)</label>
                <input id="form-itemlevel" asp-for="ItemTemplate!.ItemLevel" type="text" value="@itemTemplate.ItemLevel" pattern="[0-9]{1,3}" /> 
            </div>

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.RequiredLevel">Required Level (0-255)</label>
                <input id="form-reqlevel" asp-for="ItemTemplate!.RequiredLevel" type="text" value="@itemTemplate.RequiredLevel" pattern="[0-9]{1,3}" />
            </div>

            <div class="vmake-form-item">
                <label class="vmake-form-item-label" asp-for="ItemTemplate!.Armor">Armor (0-65535)</label>
                <input id="form-armor" asp-for="ItemTemplate!.Armor" type="text" value="@itemTemplate.Armor" pattern="[0-9]{1,5}" />
            </div>

            <!-- STATS START -->

            <div class="vmake-form-item">
                <div class="vmake-form-item-label">Stats</div>
                <div class="vmake-form-item-group">
                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType1">Stat Type 1</label>
                        <select id="form-stat-type-1" asp-for="ItemTemplate!.StatType1">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType1 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue1">Stat Value 1 (0-65535)</label>
                        <input id="form-stat-value-1" asp-for="ItemTemplate!.StatValue1" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType2">Stat Type 2</label>
                        <select id="form-stat-type-2" asp-for="ItemTemplate!.StatType2">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType2 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue2">Stat Value 2 (0-65535)</label>
                        <input id="form-stat-value-2" asp-for="ItemTemplate!.StatValue2" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType3">Stat Type 3</label>
                        <select id="form-stat-type-3" asp-for="ItemTemplate!.StatType3">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType3 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue3">Stat Value 3 (0-65535)</label>
                        <input id="form-stat-value-3" asp-for="ItemTemplate!.StatValue3" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType4">Stat Type 4</label>
                        <select id="form-stat-type-4" asp-for="ItemTemplate!.StatType4">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType4 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue4">Stat Value 4 (0-65535)</label>
                        <input id="form-stat-value-4" asp-for="ItemTemplate!.StatValue4" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType1">Stat Type 5</label>
                        <select id="form-stat-type-5" asp-for="ItemTemplate!.StatType5">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType5 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue5">Stat Value 5 (0-65535)</label>
                        <input id="form-stat-value-5" asp-for="ItemTemplate!.StatValue5" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType6">Stat Type 6</label>
                        <select id="form-stat-type-6" asp-for="ItemTemplate!.StatType6">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType6 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue1">Stat Value 6 (0-65535)</label>
                        <input id="form-stat-value-6" asp-for="ItemTemplate!.StatValue6" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType7">Stat Type 7</label>
                        <select id="form-stat-type-7" asp-for="ItemTemplate!.StatType7">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType7 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue7">Stat Value 7 (0-65535)</label>
                        <input id="form-stat-value-7" asp-for="ItemTemplate!.StatValue7" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType8">Stat Type 8</label>
                        <select id="form-stat-type-8" asp-for="ItemTemplate!.StatType8">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType8 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue1">Stat Value 8 (0-65535)</label>
                        <input id="form-stat-value-8" asp-for="ItemTemplate!.StatValue8" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType9">Stat Type 9</label>
                        <select id="form-stat-type-9" asp-for="ItemTemplate!.StatType9">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType9 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue1">Stat Value 9 (0-65535)</label>
                        <input id="form-stat-value-9" asp-for="ItemTemplate!.StatValue9" type="text" pattern="[0-9]{1,5}" />
                    </div>

                    <div class="vmake-form-item">
                        <label asp-for="ItemTemplate!.StatType10">Stat Type 10</label>
                        <select id="form-stat-type-10" asp-for="ItemTemplate!.StatType10">
                            @foreach (MangosItemStatType statType in Enum.GetValues(typeof(MangosItemStatType)))
                            {
                                if (itemTemplate.StatType1 == (int)statType)
                                {
                                    <option value="@((int)statType)" selected>@statType</option>
                                }
                                else
                                {
                                    <option value="@((int)statType)">@statType</option>
                                }
                            }
                        </select>
                        <label asp-for="ItemTemplate!.StatValue10">Stat Value 10 (0-65535)</label>
                        <input id="form-stat-value-10" asp-for="ItemTemplate!.StatValue10" type="text" pattern="[0-9]{1,5}" />
                    </div>
                </div>
            </div>


            <!-- STATS END -->

            <div class="vmake-form-item">
                <button type="submit">Update</button>
            </div>
        </form>

        <div style="flex: 2;">
            <h3>Tooltip</h3>
            <div class="vmake-tooltip" style="flex: 2">
                <span id="tooltip-name" style="color: #@(itemTemplate.Quality.GetHexColor())">@itemTemplate.Name</span>
                
                <span id="tooltip-itemlevel" style="color: #E3BF00">Item Level @itemTemplate.ItemLevel</span>
                
                @if (itemTemplate.Bonding != MangosItemBonding.None)
                {
                    <span id="tooltip-bonding">@itemTemplate.Bonding.GetBondingText()</span>
                }

                @if(itemTemplate.Armor > 0)
                {
                    <span id="tooltip-armor">@itemTemplate.Armor Armor</span>
                }

                @{ var stats = itemTemplate.GetStats(); }
                @if(stats.Count > 0)
                {
                    var index = 1;
                    foreach(var stat in stats)
                    {
                        <div id="tooltip-stat-@(index)" class="@(stat.Type == MangosItemStatType.None ? "hide" : "")">
                            <span id="tooltip-stat-value-@(index)">@(stat.Value > 0 ? "+" : "")@stat.Value</span>
                            <span id="tooltip-stat-type-@(index)">@stat.Type</span>
                        </div>

                        index++;
                    }
                }

                <span id="tooltip-reqlevel">Requires level @itemTemplate.RequiredLevel</span>

                @if (!string.IsNullOrWhiteSpace(itemTemplate.Description))
                {
                    <span id="tooltip-description" style="color: #E1D474">"@itemTemplate.Description"</span>
                }
            </div>
        </div>
    </div>
}

@if (this.Model.Error is not null)
{
    <span class="alert-danger">@this.Model.Error</span>
}